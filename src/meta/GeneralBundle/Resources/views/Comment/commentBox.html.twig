<div class="commentsWrapper">
  <span class="commentsBoxTitle" style="display: none;">
    {% set count = object.comments|length %}
    {% transchoice count with {'%count%': count} %}comments.count{% endtranschoice %}
  </span>
  <a class="commentsBoxToggle"><i class="fa fa-resize-small"></i> {% trans %}toggle{% endtrans %}</a>
  <div class="commentsContent">
    <div class="commentsInfo">
      {% transchoice count with {'%count%': count} %}comments.count{% endtranschoice %}
      <i class='fa fa-comments pull-right'></i>
    </div>
    <div class="commentsForm">
      <div class="avatar">
        <img src="{{ app.user.avatar }}" width="30" height="30" class="avatar"/>
      </div>
      <form action="{{ route }}" method="post" {{ form_enctype(form) }}>
        {{ form_widget(form.text) }}
        {{ form_widget(form._token) }}
        <input type="submit" class="btn btn-success" value="{{ "comment.post"|trans }}"/>
      </form>
    </div>
    <ul class="comments">
    {% for comment in object.comments %}
        <li>
          <div>
            <div class="avatar">
              {% if not comment.user.isDeleted %}
              <img src="{{ comment.user.avatar }}" width="30" height="30" class="avatar"/>
              {% else %}
              <img src="{{ asset("/bundles/metageneral/img/defaults/user.png") }}" width="30" height="30" class="avatar"/>
              {% endif %}
            </div>
            <div class="comment">
              <header>
                {% if not comment.user.isDeleted %}
                <a href="{{ path('u_show_user_profile', {'username': comment.user.username}) }}">{{ comment.user.getFullName }}</a>
                {% else %}<span>{{ comment.user.getFullName }}</span>{% endif %}
                 â€” <span>{{ comment.createdAt|date("date.fullFormat"|trans) }}</span></header>
              <div>
                {% if comment.isDeleted %}
                <p class="muted"><em>{{ "comment.deleted"|trans }}</em></p>
                {% else %}
                {{ comment.text|deeplinks|markdown }}
                {% endif %}
              </div>
            </div>
            {% if not comment.isDeleted %}
            <div class="actions">
              <div class="validations tooltip-trigger{% if app.user in comment.validators %} validated{% endif %}" data-toggle="tooltip" title="{% for user in comment.validators %}{{ user.getFullName() }}<br />{% endfor %}" data-placement="bottom">
                <strong><a title="{{ "comment.vote"|trans }}" class="validate-trigger" data-url="{{ path('g_validate_comment', {'id': comment.id, 'token': csrf_token('validateComment')} ) }}"><i class="fa fa-thumbs-up"></i></a> <span>{{ comment.validators|length }}</span></strong>
              </div>
              {% if comment.user == app.user %}
              <div class="delete">
                <a class="delete-trigger" data-url="{{ path('g_delete_comment', {'id': comment.id, 'token': csrf_token('deleteComment')} ) }}" title="{{ "comment.delete"|trans }}"><i class="fa fa-trash-o"></i></a>
              </div>
              {% endif %}
            </div>
            {% endif %}
          </div>
        </li>
    {% endfor %}
    </ul>
  </div>
</div>