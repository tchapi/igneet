{% extends 'metaUserBundle::layout-full.html.twig' %}

{% block title %}{{ parent() }} > {{ "user.allUsers"|trans }}{% endblock %}

{% block javascripts %}
  {{ parent() }}
    {% javascripts '@metaGeneralBundle/Resources/public/js/infinite.scroll.behaviour.js' 
            filter='?yui_js' %}
    <script src="{{ asset_url }}"></script>
    {% endjavascripts %}
{% endblock %}

{% block header %}
<div class="title">
    <h2>{{ "user.allUsers"|trans }}</h2>    
    <h4>{{ "user.listHelp"|trans({ '%community%': app.user.currentCommunity.name}) }}</h4>
</div>
{% endblock %}

{% block content %}
<div class="wrapper list">

{% if users|length > 0 %}
    
  {# FILTERS #}
  <section class="filters">
    {{ "filters.sort"|trans }}
    <a href="{{ path('u_list_users', {'sort': 'newest'}) }}"><i class="fa fa-star"></i> {{ "filters.newest"|trans }}</a> /
    <a href="{{ path('u_list_users', {'sort': 'update'}) }}"><i class="fa fa-clock-o"></i> {{ "filters.recent"|trans }}</a> /
    <a href="{{ path('u_list_users', {'sort': 'active'}) }}"><i class="fa fa-dashboard"></i> {{ "filters.active"|trans }}</a> /
    <a href="{{ path('u_list_users', {'sort': 'alpha'}) }}"><i class="fa fa-font"></i> {{ "filters.alpha"|trans }}</a>
  </section>

  <table id="list" summary="users">
    <thead>
      <tr>
        <th class="main">{{ "user.list.name"|trans }}</th>
        <th></th>
        <th><i class="fa fa-calendar"></i> {{ "user.list.created"|trans }}</th>
        <th><i class="fa fa-clock-o"></i> {{ "user.list.updated"|trans }}</th>
        <th><i class="fa fa-dashboard"></i> {{ "user.list.members"|trans }}</th>
      </tr>
    </thead>
    <tbody>
      {# TEMPLATE FOR INFINITE SCROLLING #}
      <tr class="template" style="display: none !important;">
        <td>
          <a data-href="%url%">
            <img data-src="%picture%" width="80px" height="80px"/>
          </a>
        </td>
        <td class="main">
          <a data-href="%url%">
            <div>
              <span data-private="%isGuest%"><i class="fa fa-eye-slash"></i> %name%</span>
              <span class="headline">%headline%</span>
            </div>
          </a>
        </td>
        <td>
           %createdAt%
        </td>
        <td>
          %lastSeenAt%
        </td>
        <td>
          %updatedAt%
        </td>
      </tr>
      {# END OF TEMPLATE #}
      {% for userAndIsGuest in users %}
        {% set user = userAndIsGuest['user'] %}
        <tr>
          <td>
            <a href="{{ path('u_show_user_profile', {'username': user.username}) }}">
              <img src="{{ asset(user.getAvatar()) }}" width="80px" height="80px"/>
            </a>
          </td>
          <td class="main">
            <a href="{{ path('u_show_user_profile', {'username': user.username}) }}">
              <div>
                <span private="{{ userAndIsGuest['isGuest']?"true":"false" }}"><i class="fa fa-eye-slash"></i>  {{ user.getFullName() }}</span>
                <!-- {% if userAndIsGuest['isGuest'] %} ({{ "guest"|trans }}){% endif %} -->
                <span class="headline">{{ user.headline }}</span>
              </div>
            </a>
          </td>
          <td>
             {{ user.createdAt|date("date.fullFormat"|trans) }}
          </td>
          <td>
            {{ user.lastSeenAt|date("date.fullFormat"|trans) }}
          </td>
          <td>
            {{ user.updatedAt|date("date.fullFormat"|trans) }}
          </td>
        </tr>
      {% endfor %}
    </tbody>
  </table>

  {# PAGINATION #}
  {{ include('metaGeneralBundle:Default:pagination.html.twig', { 'route': 'u_list_users', 'total_objects' : totalUsers, 'params' : {'sort': sort } }, with_context = false) }}

{% else %}
  <section class="none">
  {{ "user.none"|trans }}
  </section>
{% endif %}

</div>
{% endblock %}
