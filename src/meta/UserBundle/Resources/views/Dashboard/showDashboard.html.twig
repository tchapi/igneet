{% extends 'metaUserBundle::layout.html.twig' %}

{% block title %}{{ parent() }} > {{ user.getFullName() }} | Dashboard{% endblock %}

{% block javascripts %}
  {{ parent() }}
    {% javascripts '@metaGeneralBundle/Resources/public/js/d3.v3.js' 
                   '@metaGeneralBundle/Resources/public/js/d3.graphs.js' 
            filter='?yui_js' %}
    <script src="{{ asset_url }}"></script>
    {% endjavascripts %}
{% endblock %}

{% block header %}
  <div class="headerAvatarAndActions">
    <img src="{{ asset(user.getAvatar()) }}" width="150" height="150" class="avatar"/>
  </div>

  <div class="userInfo">

    <h2 class="ellipsis">
      <span>My personal dashboard</span>
    </h2>
    <h4>My recent activity :</h4>
    <div>
      <i class="icon-flag"></i> Last activity at {{ lastActivity|date("d/m/Y, H:i:s") }}
    </div>

    <div>
      <i class="icon-comments-alt"></i> {{ user.comments|length }} comments, {{ user.countPublicComments }} public ones
    </div>

  </div>
  <div class="graph" graph-data='{{ last7daysActivity|json_encode|raw }}' graph-width="500" graph-height="90">
    <!-- loader !!! -->
  </div>
{% endblock %}

{% block content %}

<section>
  <div class="heading"><i class="icon-home"></i> Recently in the community</div>
  <div class="row-fluid">

    <div class="content span5">
      <h4>Last ideas</h4>
      <ul>
        {% if last3ideas[0] is defined %}<li><a href="{{ path('i_show_idea', {'id' : last3ideas[0].id }) }}">{{ last3ideas[0].name|raw }}</a> - <em>Created on {{ last3ideas[0].createdAt|date("d/m/Y, H:i:s") }}</em></li>{% else %}<li>No new idea in the community ...</li>{% endif %}
        {% if last3ideas[1] is defined %}<li><a href="{{ path('i_show_idea', {'id' : last3ideas[1].id }) }}">{{ last3ideas[1].name|raw }}</a> - <em>Created on {{ last3ideas[1].createdAt|date("d/m/Y, H:i:s") }}</em></li>{% endif %}
        {% if last3ideas[2] is defined %}<li><a href="{{ path('i_show_idea', {'id' : last3ideas[2].id }) }}">{{ last3ideas[2].name|raw }}</a> - <em>Created on {{ last3ideas[2].createdAt|date("d/m/Y, H:i:s") }}</em></li>{% endif %}
      </ul>
    </div>

    <div class="content span6 offset1">
      <h4>Last projects</h4>
       <ul>
        {% if last3projects[0] is defined %}<li><a href="{{ path('sp_show_project', { 'slug': last3projects[0].slug }) }}">{{ last3projects[0].name|raw }}</a> - <em>Created on {{ last3projects[0].createdAt|date("d/m/Y, H:i:s") }}</em></li>{% else %}<li>No new project in the community ...</li>{% endif %}
        {% if last3projects[1] is defined %}<li><a href="{{ path('sp_show_project', { 'slug': last3projects[1].slug }) }}">{{ last3projects[1].name|raw }}</a> - <em>Created on {{ last3projects[1].createdAt|date("d/m/Y, H:i:s") }}</em></li>{% endif %}
        {% if last3projects[2] is defined %}<li><a href="{{ path('sp_show_project', { 'slug': last3projects[2].slug }) }}">{{ last3projects[2].name|raw }}</a> - <em>Created on {{ last3projects[2].createdAt|date("d/m/Y, H:i:s") }}</em></li>{% endif %}
      </ul>
    </div>

  </div>

</section>

<section>
  <div class="heading"><i class="icon-group"></i> Social</div>
  <div class="row-fluid">

    <div class="content span5">
      <h4>Last social events</h4>
      <ul>
        {% if lastSocial[0] is defined %}<li>{{ lastSocial[0]|raw }}</li>{% else %}<li>Nothing happened recently ...</li>{% endif %}
        {% if lastSocial[1] is defined %}<li>{{ lastSocial[1]|raw }}</li>{% endif %}
        {% if lastSocial[2] is defined %}<li>{{ lastSocial[2]|raw }}</li>{% endif %}
      </ul>
    </div>

    <div class="content span6 offset1">
      <h4>Comments you posted this week</h4>
      <div class>
        <div class="graph" graph-data='{{ last7daysCommentActivity|json_encode|raw }}' graph-width="450" graph-height="100">
          <!-- loader !!! -->
        </div>
      </div>
    </div>

  </div>

</section>

<section class="colored">
  <div class="heading"><i class="icon-beaker"></i> My top projects</div>
  <div class="row-fluid">

    <div class="content span4">
      {% if top3projects[0] is defined %}
      <h4><a href="{{ path('sp_show_project_timeline', {'slug': top3projects[0][0].slug }) }}" ><span class="avatar"><img src="{{ asset(top3projects[0][0].picture) }}"  width="20" height="20" class="miniAvatar" /></span> {{ top3projects[0][0].name }}</a></h4>
      <div class>
        {% if top3projectsActivity[top3projects[0][0].id] is defined %}
        <div class="graph" graph-data='{{ top3projectsActivity[top3projects[0][0].id]|json_encode|raw }}' graph-width="310" graph-height="100">
          <!-- loader !!! -->
        </div>
        {% else %}
        <div class="graph_placeholder">No activity last week !</div>
        {% endif %}
      </div>
      <h5>Last contributor :</h5>
      {% if top3projectsActivity[top3projects[0][0].id][0] is defined %}<span>{{ top3projects[0][0].logEntries[top3projects[0][0].logEntries|length - 1].user.getFullName }} ({{ top3projects[0][0].logEntries[top3projects[0][0].logEntries|length - 1].createdAt|date("d/m/Y, H:i:s") }})</span>{% else %}N/A{% endif %}
      <h5>Community :</h5>
      <ul>
        <li>{{ top3projects[0][0].countOwners }} owner(s)</li>
        <li>{{ top3projects[0][0].countParticipants }} participant(s)</li>
        <li>{{ top3projects[0][0].countWatchers }} watcher(s)</li>
      </ul>
      {% else %}
      <div class="blank_dashboard_item">No project here ? <a href="{{ path('sp_new_project') }}" class="btn btn-success">create a new one</a></div>
      {% endif %}
    </div>

    <div class="content span4">
      {% if top3projects[1] is defined %}
      <h4><a href="{{ path('sp_show_project_timeline', {'slug': top3projects[1][0].slug }) }}" ><span class="avatar"><img src="{{ asset(top3projects[1][0].picture) }}"  width="20" height="20" class="miniAvatar" /></span> {{ top3projects[1][0].name }}</a></h4>
      <div class>
        {% if top3projectsActivity[top3projects[1][0].id] is defined %}
        <div class="graph" graph-data='{{ top3projectsActivity[top3projects[1][0].id]|json_encode|raw }}' graph-width="310" graph-height="100">
          <!-- loader !!! -->
        </div>
        {% else %}
        <div class="graph_placeholder">No activity last week !</div>
        {% endif %}
      </div>
      <h5>Last contributor :</h5>
      {% if top3projectsActivity[top3projects[1][0].id][0] is defined %}<span>{{ top3projects[1][0].logEntries[top3projects[1][0].logEntries|length - 1].user.getFullName }} ({{ top3projects[1][0].logEntries[top3projects[1][0].logEntries|length - 1].createdAt|date("d/m/Y, H:i:s") }})</span>{% else %}N/A{% endif %}
      <h5>Community :</h5>
      <ul>
        <li>{{ top3projects[1][0].countOwners }} owner(s)</li>
        <li>{{ top3projects[1][0].countParticipants }} participant(s)</li>
        <li>{{ top3projects[1][0].countWatchers }} watcher(s)</li>
      </ul>
      {% else %}
      <div class="blank_dashboard_item">No project here ? <a href="{{ path('sp_new_project') }}" class="btn btn-success">create a new one</a></div>
      {% endif %}
    </div>
    
    <div class="content span4">
      {% if top3projects[2] is defined %}
      <h4><a href="{{ path('sp_show_project_timeline', {'slug': top3projects[2][0].slug }) }}" ><span class="avatar"><img src="{{ asset(top3projects[2][0].picture) }}"  width="20" height="20" class="miniAvatar" /></span> {{ top3projects[2][0].name }}</a></h4>
      <div class>
        {% if top3projectsActivity[top3projects[2][0].id] is defined %}
        <div class="graph" graph-data='{{ top3projectsActivity[top3projects[2][0].id]|json_encode|raw }}' graph-width="310" graph-height="100">
          <!-- loader !!! -->
        </div>
        {% else %}
        <div class="graph_placeholder">No activity last week !</div>
        {% endif %}
      </div>
      <h5>Last contributor :</h5>
      {% if top3projectsActivity[top3projects[2][0].id][0] is defined %}<span>{{ top3projects[2][0].logEntries[top3projects[2][0].logEntries|length - 1].user.getFullName }} ({{ top3projects[2][0].logEntries[top3projects[2][0].logEntries|length - 1].createdAt|date("d/m/Y, H:i:s") }})</span>{% else %}N/A{% endif %}
      <h5>Community :</h5>
      <ul>
        <li>{{ top3projects[2][0].countOwners }} owner(s)</li>
        <li>{{ top3projects[2][0].countParticipants }} participant(s)</li>
        <li>{{ top3projects[2][0].countWatchers }} watcher(s)</li>
      </ul>
      {% else %}
      <div class="blank_dashboard_item">No project here ? <a href="{{ path('sp_new_project') }}" class="btn btn-success">create a new one</a></div>
      {% endif %}
    </div>
    
  </div>

</section>

<section>
  <div class="heading"><i class="icon-lightbulb"></i> My top ideas</div>
  <div class="row-fluid">

    <div class="content span4">
      {% if top3ideas[0] is defined %}
      <h4><a href="{{ path('i_show_idea_timeline', {'id': top3ideas[0][0].id }) }}" ><span class="avatar"><img src="{{ asset(top3ideas[0][0].picture) }}"  width="20" height="20" class="miniAvatar" /></span> {{ top3ideas[0][0].name }}</a></h4>
      <div class>
        {% if top3ideasActivity[top3ideas[0][0].id] is defined %}
        <div class="graph" graph-data='{{ top3ideasActivity[top3ideas[0][0].id]|json_encode|raw }}' graph-width="310" graph-height="100">
          <!-- loader !!! -->
        </div>
        {% else %}
        <div class="graph_placeholder">No activity last week !</div>
        {% endif %}
      </div>
      <h5>Last contributor :</h5>
      {% if top3ideasActivity[top3ideas[0][0].id][0] is defined %}<span>{{ top3ideas[0][0].logEntries[top3ideas[0][0].logEntries|length - 1].user.getFullName }} ({{ top3ideas[0][0].logEntries[top3ideas[0][0].logEntries|length - 1].createdAt|date("d/m/Y, H:i:s") }})</span>{% else %}N/A{% endif %}
      <h5>Community :</h5>
      <ul>
        <li>{{ top3ideas[0][0].countParticipants }} participant(s)</li>
        <li>{{ top3ideas[0][0].countWatchers }} watcher(s)</li>
      </ul>
      {% else %}
      <div class="blank_dashboard_item">No idea here ? <a href="{{ path('i_new_idea') }}" class="btn btn-success">initiate a new one</a></div>
      {% endif %}
    </div>

    <div class="content span4">
      {% if top3ideas[1] is defined %}
      <h4><a href="{{ path('i_show_idea_timeline', {'id': top3ideas[1][0].id }) }}" ><span class="avatar"><img src="{{ asset(top3ideas[1][0].picture) }}"  width="20" height="20" class="miniAvatar" /></span> {{ top3ideas[1][0].name }}</a></h4>
      <div class>
        {% if top3ideasActivity[top3ideas[1][0].id] is defined %}
        <div class="graph" graph-data='{{ top3ideasActivity[top3ideas[1][0].id]|json_encode|raw }}' graph-width="310" graph-height="100">
          <!-- loader !!! -->
        </div>
        {% else %}
        <div class="graph_placeholder">No activity last week !</div>
        {% endif %}
      </div>
      <h5>Last contributor :</h5>
      {% if top3ideasActivity[top3ideas[1][0].id][0] is defined %}<span>{{ top3ideas[1][0].logEntries[top3ideas[1][0].logEntries|length - 1].user.getFullName }} ({{ top3ideas[1][0].logEntries[top3ideas[1][0].logEntries|length - 1].createdAt|date("d/m/Y, H:i:s") }})</span>{% else %}N/A{% endif %}
      <h5>Community :</h5>
      <ul>
        <li>{{ top3ideas[1][0].countParticipants }} participant(s)</li>
        <li>{{ top3ideas[1][0].countWatchers }} watcher(s)</li>
      </ul>
      {% else %}
      <div class="blank_dashboard_item">No idea here ? <a href="{{ path('i_new_idea') }}" class="btn btn-success">initiate a new one</a></div>
      {% endif %}
    </div>
    
    <div class="content span4">
      {% if top3ideas[2] is defined %}
      <h4><a href="{{ path('i_show_idea_timeline', {'id': top3ideas[2][0].id }) }}" ><span class="avatar"><img src="{{ asset(top3ideas[2][0].picture) }}"  width="20" height="20" class="miniAvatar" /></span> {{ top3ideas[2][0].name }}</a></h4>
      <div class>
        {% if top3ideasActivity[top3ideas[2][0].id] is defined %}
        <div class="graph" graph-data='{{ top3ideasActivity[top3ideas[2][0].id]|json_encode|raw }}' graph-width="310" graph-height="100">
          <!-- loader !!! -->
        </div>
        {% else %}
        <div class="graph_placeholder">No activity last week !</div>
        {% endif %}
      </div>
      <h5>Last contributor :</h5>
      {% if top3ideasActivity[top3ideas[2][0].id][0] is defined %}<span>{{ top3ideas[2][0].logEntries[top3ideas[2][0].logEntries|length - 1].user.getFullName }} ({{ top3ideas[2][0].logEntries[top3ideas[2][0].logEntries|length - 1].createdAt|date("d/m/Y, H:i:s") }})</span>{% else %}N/A{% endif %}
      <h5>Community :</h5>
      <ul>
        <li>{{ top3ideas[2][0].countParticipants }} participant(s)</li>
        <li>{{ top3ideas[2][0].countWatchers }} watcher(s)</li>
      </ul>
      {% else %}
      <div class="blank_dashboard_item">No idea here ? <a href="{{ path('i_new_idea') }}" class="btn btn-success">initiate a new one</a></div>
      {% endif %}
    </div>
    
  </div>

</section>
{% endblock %}