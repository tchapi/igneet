<div class="commentsWrapper">
  <span class="commentsBoxTitle" style="display: none;"><span>{{ object.comments|length }}</span> comment{% if object.comments|length > 1 %}s{% endif %}</span>
  <a class="commentsBoxToggle"><i class="icon-resize-small"></i> toggle</a>
  <div class="commentsContent">
    <div class="commentsInfo">
      <span>{{ object.comments|length }}</span> comment{% if object.comments|length > 1 %}s{% endif %}
      <i class='icon-comments pull-right'></i>
    </div>
    <div class="commentsForm">
      <div class="avatar">
        <img src="{{ app.user.avatar }}" width="30" height="30" class="avatar"/>
      </div>
      <form action="{{ route }}" method="post" {{ form_enctype(form) }}>
        {{ form_widget(form.text) }}
        {{ form_widget(form._token) }}
        <input type="submit" class="btn btn-success" value="Post"/>
      </form>
    </div>
    <ul class="comments">
    {% for comment in object.comments %}
        <li>
          <div>
            <div class="avatar">
              {% if comment.user %}
              <img src="{{ comment.user.avatar }}" width="30" height="30" class="avatar"/>
              {% else %}
              <img src="{{ asset("/bundles/metageneral/img/defaults/user.png") }}" width="30" height="30" class="avatar"/>
              {% endif %}
            </div>
            <div class="comment">
              <header>
                {% if comment.user %}
                <a href="{{ path('u_show_user_profile', {'username': comment.user.username}) }}">{{ comment.user.firstName }}</a>
                {% else %}<span class="muted">Deleted user</span>{% endif %}
                 â€” <span>{{ comment.createdAt|date("d/m/Y H:i") }}</span></header>
              <div>
                {% if comment.isDeleted %}
                <p class="muted"><em>Deleted comment</em></p>
                {% else %}
                {{ comment.text|deeplinks|markdown }}
                {% endif %}
              </div>
            </div>
            {% if not comment.isDeleted %}
            <div class="actions">
              <div class="validations tooltip-trigger{% if app.user in comment.validators %} validated{% endif %}" data-toggle="tooltip" title="{% for user in comment.validators %}{{ user.getFullName() }}<br />{% endfor %}" data-placement="bottom">
                <strong><a title="Vote for this comment" class="validate-trigger" data-url="{{ path('g_validate_comment', {'id': comment.id, 'token': csrf_token('validateComment')} ) }}"><i class="icon-thumbs-up"></i></a> <span>{{ comment.validators|length }}</span></strong>
              </div>
              {% if comment.user == app.user %}
              <div class="delete">
                <a class="delete-trigger" data-url="{{ path('g_delete_comment', {'id': comment.id, 'token': csrf_token('deleteComment')} ) }}" title="Delete my comment"><i class="icon-trash"></i></a>
              </div>
              {% endif %}
            </div>
            {% endif %}
          </div>
        </li>
    {% endfor %}
    </ul>
  </div>
</div>