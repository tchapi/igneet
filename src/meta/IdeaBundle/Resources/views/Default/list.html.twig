{% extends 'metaIdeaBundle::layout.html.twig' %}

{% block title %}{{ parent() }} > {{ "idea.allIdeas"|trans }}{% endblock %}

{% block header %}
  
  {% if app.user.currentCommunity is not null %}
  <div class="avatar">
    <img src="{{ asset(app.user.currentCommunity.getPicture()) }}" />
  </div>
  <div class="info">
  {% else %}
  <div class="title">
  {% endif %}

    <h2>{% if archived %}{{ "idea.titleArchived"|trans }}{% else %}{{ "idea.title"|trans }}{% endif %}</h2>
    
    <h4>
      {% if app.user.currentCommunity is not null %}
        {{ "idea.listHelp.community"|trans({ '%community%': app.user.currentCommunity.name}) }}
      {% else %}
        {{ "idea.listHelp.privateSpace"|trans }}
      {% endif %}
    </h4>

    <p>
    {% if not archived %}
      <a href="{{ path('i_new_idea') }}" class="button"><i class="fa fa-pencil"></i> {{ "idea.new"|trans }}</a>
      <a href="{{ path('i_list_archived_ideas') }}" class="button button-info"><i class="fa fa-archive"></i> {{ "idea.view.archived"|trans }}</a>
    {% else %}
      <a href="{{ path('i_list_ideas') }}" class="button button-success">{{ "idea.view.all"|trans }}</a>
    {% endif %}
    </p>

  </div>
{% endblock %}

{% block content %}
<div class="wrapper list">

{% if ideas %}

    <section>
      {{ "filters.sort"|trans }}
      <a href="{{ path(archived?'i_list_archived_ideas':'i_list_ideas', {'sort': 'newest', 'page' : pagination.page}) }}"><i class="fa fa-star"></i> {{ "filters.newest"|trans }}</a> /
      <a href="{{ path(archived?'i_list_archived_ideas':'i_list_ideas', {'sort': 'update', 'page' : pagination.page}) }}"><i class="fa fa-clock-o"></i> {{ "filters.recent"|trans }}</a> /
      <a href="{{ path(archived?'i_list_archived_ideas':'i_list_ideas', {'sort': 'alpha', 'page' : pagination.page}) }}"><i class="fa fa-font"></i> {{ "filters.alpha"|trans }}</a>
    </section>

  {% for idea in ideas %}
  <section>

    <a href="{{ path('i_show_idea', {'uid': idea.id|to_uid }) }}">
      <img src="{{ asset(idea.getPicture()) }}" width="100" height="100"/>
    </a>

    <div class="listingItemInfo">
      <h4 class="ellipsis"><a href="{{ path('i_show_idea', {'uid': idea.id|to_uid }) }}">{{ idea.name }}</a></h4>
      <div class="ellipsis">{{ idea.headline }}</div>
      <div class="muted"><i class="fa fa-calendar"></i>
       {{ "idea.info.created.long"|transchoice(idea.countCreators, {'%date%': idea.createdAt|date("date.fullFormat"|trans), '%name%': idea.getACreator().getFullName(), '%count%': idea.countCreators}) }}
      </div>
      <div class="muted"><i class="fa fa-clock-o"></i> {{ "idea.info.last.updated"|trans({'%date%': idea.updatedAt|date("date.fullFormat"|trans)}) }}</div>
    </div>

    {% if idea.countWatchers > 0 %}
    <div class="listingItemRelatedObjects">
      
      <div class="type">
        <div class="muted pull-right">
          {{ "idea.watchers"|transchoice(idea.countWatchers, { '%count': idea.countWatchers}) }}
        </div>
      </div>

      <ul>
        {% if idea.countWatchers > 5 %}
        <li>
          <div class="miniTextAvatar">...</div>
        </li>
        {% endif %}
        {% for watcher in idea.getRandomWatchers(5) %}
          {% if not watcher.isDeleted %}
          <li>
            <a href="{{ path('u_show_user_profile', {'username': watcher.username}) }}">
              <img src="{{ watcher.avatar }}" title="{{ watcher.getFullName }}" width="30" height="30" class="miniAvatar"/>
            </a>
          </li>
          {% endif %}
        {% endfor %}
      </ul>
    </div>
    {% endif %}

  </section>
  {% endfor %}
  <section>
  {% render(controller("metaGeneralBundle:Default:pagination",{ 'route': archived?'i_list_archived_ideas':'i_list_ideas', 'page' : pagination.page, 'total' : pagination.totalIdeas, 'params' : {'sort': sort } })) %}
  </section>
{% else %}
  <section>
  {{ "idea.none"|trans }}
  </section>
{% endif %}

</div>
{% endblock %}
